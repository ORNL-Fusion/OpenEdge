SPARTA-OPENEDGE (20 Jan 2025)
Running on 4 MPI task(s)
# Copyright 2024, OpenEdge contributors
# Authors: Abdou Diaw
# License: GPL-2.0 license
# This script simulate lithium (Li) droplet dynamics in a uniform plasma environment using CAT.
# Setup: 2D domain with magnetic field equilibrium and plasma at sound speed along magnetic field lines.


############################################------simulation domain setup-------#####################################
seed                12345
dimension           2
boundary            r r p
global              gridcut 0.0 comm/sort no
create_box          2. 6 -4. 3.8 -0.05 0.05
Created orthogonal box = (2 -4 -0.05) to (6 3.8 0.05)

create_grid         1000 1000 1
WARNING: Could not acquire nearby ghost cells b/c grid partition is not clumped (/Users/42d/OpenEdge_ORNL_GITHUB/src/grid.cpp:472)
Created 1000000 child grid cells
  CPU time = 0.059579 secs
  create/ghost percent = 85.0199 14.9801
balance_grid        rcb  cell
Balance grid migrated 750000 cells
  CPU time = 0.187995 secs
  reassign/sort/migrate/ghost percent = 26.0198 3.14636 51.8812 18.9526

############################################------species in the plasma (current and future)-------#####################################
species droplet.species mist
mixture             LigamentSource  mist        frac 1.0


############################################------set properties of wall: material and interaction-------#####################################
#global target_material Li mass 7.0 charge 3.0 binding_energy 1.64

read_surf          wall.surf group surfID particle check
  156 lines
  2.43158 5.6 xlo xhi
  -3.77748 3.77748 ylo yhi
  0 0 zlo zhi
  0.0146051 min line length
  3622 0 = cells overlapping surfs, overlap cells with unmarked corner pts
  476022 520356 3622 = cells outside/inside/overlapping surfs
  3622 = surf cells with 1,2,etc splits
  14.8969 14.8969 = cell-wise and global flow volume
  CPU time = 0.076679 secs
  read/check/sort/surf2grid/ghost/inout/particle percent = 0.525568 0.588166 10.6365 60.0712 28.1785 38.0104 0.00130414
  surf2grid time = 0.046062 secs
  map/comm1/comm2/comm3/comm4/split percent = 30.4937 0.625244 27.0635 4.88906 7.96318 11.1133
surf_collide       wallColModel vanish
surf_modify        all collide wallColModel

read_surf          core.surf invert group surfID2 particle check
  296 lines
  2.8168 5.26754 xlo xhi
  -2.20288 2.19899 ylo yhi
  0 0 zlo zhi
  4.44089e-16 min line length
  5974 0 = cells overlapping surfs, overlap cells with unmarked corner pts
WARNING: Surface check found 4 points nearly on lines (/Users/42d/OpenEdge_ORNL_GITHUB/src/surf.cpp:1752)
  213778 780248 5974 = cells outside/inside/overlapping surfs
  5974 = surf cells with 1,2,etc splits
  6.75111 6.75111 = cell-wise and global flow volume
  CPU time = 0.070771 secs
  read/check/sort/surf2grid/ghost/inout/particle percent = 1.32116 0.204886 11.5513 58.7119 28.2107 42.906 0.00141301
  surf2grid time = 0.041551 secs
  map/comm1/comm2/comm3/comm4/split percent = 27.9993 0.0866405 32.1701 5.62682 8.29102 12.1417
surf_modify        surfID2 collide wallColModel

variable pmass  particle mass
#variable pmass  particle temp


group            divertor_outer surf id <> 37 50
0 = initial surface count in group divertor_outer
14 = final surface count in group divertor_outer
group            divertor_inner surf id <> 10 17
0 = initial surface count in group divertor_inner
8 = final surface count in group divertor_inner

variable vmag equal 2. # m/s
variable mW   equal 2.796017461694916e-10    # kg
variable E_J  equal 0.5*${mW}*${vmag}*${vmag}   # Joules
variable E_J  equal 0.5*2.79601746169492e-10*${vmag}*${vmag}   
variable E_J  equal 0.5*2.79601746169492e-10*2*${vmag}   
variable E_J  equal 0.5*2.79601746169492e-10*2*2   
variable E_eV equal ${E_J}/1.602176634e-19      # eV
variable E_eV equal 5.59203492338984e-10/1.602176634e-19      
# equivalent temperature (Kelvin)
variable kB   equal 1.380649e-23             # J/K
variable T  equal (2.0/3.0)*${E_J}/${kB}
variable T  equal (2.0/3.0)*5.59203492338984e-10/${kB}
variable T  equal (2.0/3.0)*5.59203492338984e-10/1.380649e-23

global              nrho 1e16 fnum 1 temp $T
global              nrho 1e16 fnum 1 temp 27001962716518.8

fix              in emit/surf LigamentSource divertor_outer normal yes n 1 perspecies no

variable dt equal 1e-5
variable time equal 8.5 # seconds
variable N equal floor(${time}/${dt})
variable N equal floor(8.5/${dt})
variable N equal floor(8.5/1e-05)
variable N1 equal floor($N/100)
variable N1 equal floor(849999/100)
variable N2 equal floor($N/100)
variable N2 equal floor(849999/100)



variable min_dt equal 0.05
variable nevery equal 1 #${min_dt}/${dt}
variable temp equal 773.15 # Kelvin
variable rd equal 50e-6 # m
variable md equal 2.796017461694916e-10
#fix 22 evap ${nevery} mass ${md} radius ${rd} temp ${temp} heatflux/file heatflux.h5
fix 22 evap ${nevery} mass ${md} radius ${rd} temp ${temp} heatflux/constant 50e6
fix 22 evap 1 mass ${md} radius ${rd} temp ${temp} heatflux/constant 50e6
fix 22 evap 1 mass 2.79601746169492e-10 radius ${rd} temp ${temp} heatflux/constant 50e6
fix 22 evap 1 mass 2.79601746169492e-10 radius 5e-05 temp ${temp} heatflux/constant 50e6
fix 22 evap 1 mass 2.79601746169492e-10 radius 5e-05 temp 773.15 heatflux/constant 50e6
dump 10 particle all 10 LigamentSource_no_g  id type x y z vx vy vz v_pmass temp radius


timestep ${dt}
timestep 1e-05

stats 1
run 1
Memory usage per proc in Mbytes:
  particles (ave,min,max) = 0 0 0
  grid      (ave,min,max) = 44.6388 44.6388 44.6388
  surf      (ave,min,max) = 0.0465546 0.0465546 0.0465546
  total     (ave,min,max) = 44.6853 44.6853 44.6853
Step CPU Np 
       0            0        0 
       1     0.002408        1 
Loop time of 0.002756 on 4 procs for 1 steps with 1 particles

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Move    | 2.8e-05    | 4.4e-05    | 5.4e-05    |   0.0 |  1.60
Coll    | 0          | 0          | 0          |   0.0 |  0.00
Sort    | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 3.1e-05    | 3.125e-05  | 3.2e-05    |   0.0 |  1.13
Modify  | 0.002163   | 0.0022868  | 0.00247    |   0.3 | 82.97
Output  | 1.2e-05    | 0.0002475  | 0.00035    |   0.0 |  8.98
Other   |            | 0.0001465  |            |       |  5.32

Particle moves    = 1 (0.001K)
Cells touched     = 1 (0.001K)
Particle comms    = 0 (0K)
Boundary collides = 0 (0K)
Boundary exits    = 0 (0K)
SurfColl checks   = 2 (0.002K)
SurfColl occurs   = 0 (0K)
Surf reactions    = 0 (0K)
Collide attempts  = 0 (0K)
Collide occurs    = 0 (0K)
Reactions         = 0 (0K)
Particles stuck   = 0
Axisymm bad moves = 0

Particle-moves/CPUsec/proc: 90.7112
Particle-moves/step: 1
Cell-touches/particle/step: 1
Particle comm iterations/step: 1
Particle fraction communicated: 0
Particle fraction colliding with boundary: 0
Particle fraction exiting boundary: 0
Surface-checks/particle/step: 2
Surface-collisions/particle/step: 0
Surf-reactions/particle/step: 0
Collision-attempts/particle/step: 0
Collisions/particle/step: 0
Reactions/particle/step: 0

Particles: 0.25 ave 1 max 0 min
Histogram: 3 0 0 0 0 0 0 0 0 1
Cells:      250000 ave 250000 max 250000 min
Histogram: 4 0 0 0 0 0 0 0 0 0
GhostCell: 1001 ave 1001 max 1001 min
Histogram: 4 0 0 0 0 0 0 0 0 0
EmptyCell: 1001 ave 1001 max 1001 min
Histogram: 4 0 0 0 0 0 0 0 0 0
Surfs:    452 ave 452 max 452 min
Histogram: 4 0 0 0 0 0 0 0 0 0
GhostSurf: 0 ave 0 max 0 min
Histogram: 4 0 0 0 0 0 0 0 0 0
unfix in
variable g equal -9.8
variable gradBx grid "v_g"
#fix BY field/grid NULL gradBx NULL
#global   field grid BY 1

variable npart equal np
fix 31 halt 1000 v_npart <= 0

stats  100 #${N2}
run 34000 #$N
Memory usage per proc in Mbytes:
  particles (ave,min,max) = 0.515625 0 2.0625
  grid      (ave,min,max) = 44.6388 44.6388 44.6388
  surf      (ave,min,max) = 0.0465546 0.0465546 0.0465546
  total     (ave,min,max) = 45.201 44.6853 46.7478
Step CPU Np 
       1            0        1 
     100     0.250985        1 
     200     0.455256        1 
     300     0.663176        1 
     400     0.864144        1 
     500     1.066902        1 
     600     1.272587        1 
     700     1.476771        1 
     800     1.680971        1 
     900     1.883101        1 
    1000     2.083633        1 
    1100     2.284865        1 
    1200     2.503716        1 
    1300     2.703667        1 
    1400     2.910725        1 
    1500     3.111333        1 
    1600     3.312254        1 
    1700     3.518595        1 
    1800     3.720247        1 
    1900     3.920915        1 
    2000     4.121774        1 
    2100     4.322787        1 
    2200     4.523025        1 
    2300     4.723716        1 
    2400     4.924964        1 
    2500     5.126733        1 
    2600     5.330123        1 
    2700      5.53227        1 
    2800     5.733646        1 
    2900     5.958733        1 
    3000     6.172877        1 
    3100     6.434072        1 
    3200     6.671153        1 
    3300     6.872801        1 
    3400     7.078079        1 
    3500     7.299232        1 
    3600     7.517658        1 
    3700     7.723102        1 
    3800     7.924388        1 
    3900     8.124179        1 
    4000     8.327265        1 
    4100     8.529356        1 
    4200     8.732172        1 
    4300     8.934378        1 
    4400     9.136533        1 
    4500     9.341673        1 
    4600     9.544534        1 
    4700     9.746401        1 
    4800     9.948995        1 
    4900    10.151003        1 
    5000    10.358988        1 
    5100    10.563697        1 
    5200     10.76575        1 
    5300    10.971695        1 
    5400    11.176065        1 
    5500    11.378435        1 
    5600    11.581731        1 
    5700    11.784943        1 
    5800    11.988789        1 
    5900    12.191109        1 
    6000    12.396389        1 
    6100    12.597887        1 
    6200    12.796222        1 
    6300    12.999549        1 
    6400    13.201047        1 
    6500    13.401982        1 
    6600    13.604488        1 
    6700    13.806045        1 
    6800    14.005974        1 
    6900    14.211727        1 
    7000    14.416201        1 
    7100    14.619259        1 
    7200    14.824579        1 
    7300    15.026237        1 
    7400    15.234003        1 
    7500    15.435949        1 
    7600    15.638679        1 
    7700     15.84179        1 
    7800    16.044439        1 
    7900    16.253954        1 
    8000    16.457349        1 
    8100    16.661381        1 
    8200    16.869368        1 
    8300    17.072586        1 
    8400     17.27421        1 
    8500     17.47921        1 
    8600    17.680881        1 
    8700    17.882315        1 
    8800     18.08468        1 
    8900    18.286682        1 
    9000    18.488926        1 
    9100    18.692995        1 
    9200    18.898311        1 
    9300    19.099325        1 
    9400    19.302262        1 
    9500    19.516985        1 
    9600    19.728476        1 
    9700    19.937034        1 
    9800    20.209877        1 
    9900    20.435474        1 
   10000    20.639164        1 
   10100    20.840017        1 
   10200    21.041788        1 
   10300    21.242141        1 
   10400    21.443865        1 
   10500    21.652138        1 
   10600    21.857784        1 
   10700    22.064266        1 
   10800    22.264373        1 
   10900    22.476992        1 
   11000    22.681732        1 
   11100    22.886906        1 
   11200    23.090266        1 
   11300    23.308785        1 
   11400    23.534223        1 
   11500    23.744764        1 
   11600    24.015343        1 
   11700    24.221089        1 
   11800    24.424323        1 
   11900    24.718008        1 
   12000    24.924874        1 
   12100    25.127081        1 
   12200     25.32735        1 
   12300    25.529517        1 
   12400    25.730239        1 
   12500    25.930615        1 
   12600    26.133024        1 
   12700    26.338237        1 
   12800    26.540752        1 
   12900    26.749599        1 
   13000    26.953082        1 
   13100    27.151229        1 
   13200    27.352081        1 
   13300    27.557787        1 
   13400    27.759208        1 
   13500     27.95979        1 
   13600    28.162551        1 
   13700    28.364349        0 
   13800    28.567262        0 
   13900    28.776235        0 
Fix halt condition for fix-id 31 met on step 14000 with value 0 (/Users/42d/OpenEdge_ORNL_GITHUB/src/fix_halt.cpp:222)
   14000    28.978434        0 
Loop time of 28.9784 on 4 procs for 13999 steps with 0 particles

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Move    | 0.002721   | 0.0044112  | 0.009034   |   4.0 |  0.02
Coll    | 0          | 0          | 0          |   0.0 |  0.00
Sort    | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0.13125    | 0.13404    | 0.13903    |   0.8 |  0.46
Modify  | 27.799     | 27.83      | 27.849     |   0.4 | 96.04
Output  | 0.11472    | 0.124      | 0.14903    |   4.1 |  0.43
Other   |            | 0.8864     |            |       |  3.06

Particle moves    = 13646 (13.6K)
Cells touched     = 13715 (13.7K)
Particle comms    = 0 (0K)
Boundary collides = 0 (0K)
Boundary exits    = 0 (0K)
SurfColl checks   = 465 (0.465K)
SurfColl occurs   = 1 (0.001K)
Surf reactions    = 0 (0K)
Collide attempts  = 0 (0K)
Collide occurs    = 0 (0K)
Reactions         = 0 (0K)
Particles stuck   = 0
Axisymm bad moves = 0

Particle-moves/CPUsec/proc: 117.725
Particle-moves/step: 0.974784
Cell-touches/particle/step: 1.00506
Particle comm iterations/step: 1
Particle fraction communicated: 0
Particle fraction colliding with boundary: 0
Particle fraction exiting boundary: 0
Surface-checks/particle/step: 0.0340759
Surface-collisions/particle/step: 7.32815e-05
Surf-reactions/particle/step: 0
Collision-attempts/particle/step: 0
Collisions/particle/step: 0
Reactions/particle/step: 0

Particles: 0 ave 0 max 0 min
Histogram: 4 0 0 0 0 0 0 0 0 0
Cells:      250000 ave 250000 max 250000 min
Histogram: 4 0 0 0 0 0 0 0 0 0
GhostCell: 1001 ave 1001 max 1001 min
Histogram: 4 0 0 0 0 0 0 0 0 0
EmptyCell: 1001 ave 1001 max 1001 min
Histogram: 4 0 0 0 0 0 0 0 0 0
Surfs:    452 ave 452 max 452 min
Histogram: 4 0 0 0 0 0 0 0 0 0
GhostSurf: 0 ave 0 max 0 min
Histogram: 4 0 0 0 0 0 0 0 0 0

